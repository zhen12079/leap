# LeapAI框架学习指南

## 🎯 学习目标
系统掌握LeapAI框架，能够独立开发、调试和扩展自动驾驶感知算法

## 📋 学习路线

### 阶段1：框架整体理解 (1-2天)

#### 1.1 核心设计理念
- **多任务统一训练**：理解如何在一个框架中处理多个感知任务
- **节点化模型**：学习NodeGraph的设计思想
- **配置驱动**：掌握Python配置系统的使用
- **分布式原生**：了解多机多卡训练的支持机制

#### 1.2 关键文件阅读顺序
```
README.md → tools/main.py → leapai/__init__.py → leapai/registry.py
```

**学习要点**：
- 框架解决的问题和设计目标
- 统一入口的工作原理
- 组件注册和构建机制

### 阶段2：配置系统和入口机制 (1天)

#### 2.1 配置系统深度学习
**核心文件**：
- `leapai/utils/config.py` - 配置加载机制
- `projects/perception/configs/lpperception_current_hpa_step1.py` - 实际配置示例

**实践任务**：
1. 修改配置文件中的学习率、batch size等参数
2. 添加新的配置项并验证加载
3. 理解主配置和子任务配置的关系

#### 2.2 入口机制分析
**核心文件**：`tools/main.py`

**学习要点**：
- 命令行参数解析
- 配置文件加载流程
- 训练/验证/测试模式切换
- Lightning Trainer的初始化

### 阶段3：数据模块和数据处理流程 (2-3天)

#### 3.1 数据模块核心
**核心文件**：
- `leapai/data/data_module.py` - DataModule实现
- `leapai/data/dataloader/combined_dataloader.py` - 多任务数据加载
- `leapai/data/sampler/rank_split_sampler.py` - 分布式采样

#### 3.2 数据集和数据处理
**核心文件**：
- `projects/perception/dataset/` - 感知任务数据集实现
- `leapai/data/transform/` - 数据变换和增强
- `leapai/data/target/` - 标注处理

**实践任务**：
1. 理解数据加载的完整流程
2. 分析数据增强的实现
3. 学习多任务数据的组合方式

### 阶段4：模型构建和NodeGraph机制 (2-3天)

#### 4.1 NodeGraph核心机制
**核心文件**：`leapai/model/node_graph.py`

**学习要点**：
- 节点化模型的设计思想
- 多任务拓扑的定义方式
- 自动优化器配置
- 梯度累积和同步机制

#### 4.2 模型组件
**核心目录**：
- `leapai/model/backbone/` - 骨干网络
- `leapai/model/neck/` - 特征融合网络
- `leapai/model/task_module/` - 任务特定模块

### 阶段5：多任务训练和拓扑定义 (2天)

#### 5.1 拓扑定义
**核心文件**：`projects/perception/topology.py`

**学习要点**：
- 任务拓扑的定义方法
- 前向传播的数据流
- 损失函数的计算和聚合
- 训练和推理模式切换

#### 5.2 多任务协调
**学习要点**：
- 不同任务的权重平衡
- 数据采样策略
- 梯度同步机制

### 阶段6：感知任务的具体实现 (3-4天)

#### 6.1 动态任务 (目标检测)
**核心文件**：`projects/perception/dynamic.py`

**学习要点**：
- 3D目标检测的实现
- DETR-based检测头
- 时序融合机制
- 目标属性分类

#### 6.2 静态任务 (地图构建)
**核心文件**：`projects/perception/static.py`

**学习要点**：
- 语义分割的实现
- 车道线实例分割
- 地图元素的表示方法
- 多类别分割头设计

#### 6.3 占用网络
**学习要点**：
- 3D体素分割
- 点云处理
- 场景占用预测

### 阶段7：分布式训练和部署机制 (1-2天)

#### 7.1 分布式训练
**学习要点**：
- DDP策略配置
- 多机通信机制
- 数据并行和模型并行

#### 7.2 部署相关
**学习要点**：
- ONNX导出
- 模型量化
- 推理优化

## 🛠️ 实践项目

### 项目1：运行完整训练任务
**目标**：成功运行一个感知任务的完整训练流程

**步骤**：
1. 配置环境和数据路径
2. 修改配置文件
3. 启动训练任务
4. 监控训练过程
5. 分析训练结果

### 项目2：添加新的感知任务
**目标**：在框架中添加一个新的感知任务

**步骤**：
1. 定义任务配置
2. 实现数据处理
3. 设计模型头部
4. 定义拓扑函数
5. 集成到多任务训练

### 项目3：扩展现有组件
**目标**：修改或扩展现有的模型组件

**步骤**：
1. 选择要修改的组件
2. 理解现有实现
3. 设计新的功能
4. 实现和测试
5. 性能对比分析

## 📖 学习资源

### 推荐阅读顺序
1. **基础理论**：PyTorch Lightning官方文档
2. **框架设计**：阅读核心模块源码
3. **实践案例**：分析现有任务实现
4. **高级特性**：分布式训练和部署

### 调试技巧
1. 使用VSCode调试功能
2. 添加日志输出
3. 可视化中间结果
4. 性能分析工具

## 🎯 学习检查点

### 第1周检查点
- [ ] 理解框架整体架构
- [ ] 能够修改配置文件
- [ ] 成功运行训练任务

### 第2周检查点
- [ ] 理解数据处理流程
- [ ] 掌握NodeGraph机制
- [ ] 能够分析多任务训练

### 第3周检查点
- [ ] 理解感知任务实现
- [ ] 能够添加新任务
- [ ] 掌握部署流程

## 💡 学习建议

1. **循序渐进**：按照学习路线逐步深入
2. **实践为主**：每个阶段都要动手实践
3. **源码阅读**：深入理解实现细节
4. **问题驱动**：带着具体问题学习
5. **文档记录**：记录学习心得和问题

## 🤝 获取帮助

- 查看框架文档和注释
- 分析现有代码实现
- 参考测试用例
- 使用调试工具分析问题
